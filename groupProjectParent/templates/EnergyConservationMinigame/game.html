<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Saver Challenge</title>
    {% load static %}
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
            background: url('{% static "EnergyConservationMinigame/dorm_room.jpg" %}') no-repeat center center fixed;
            background-size: cover;
        }

        .device-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .device {
            margin: 10px;
            cursor: pointer;
            text-align: center;
        }

            .device img {
                width: 100px;
                height: 100px;
            }

        #timer {
            font-size: 20px;
            font-weight: bold;
            color: red;
        }
    </style>
</head>
<body>
    <h1>Energy Saver Challenge</h1>
    <p>Turn off all devices before time runs out!</p>

    <h2 id="timer">Time Left: <span id="time-value">{{ time_left }}</span> seconds</h2>

    {% load static %}

    <div class="device-container">
        {% for device, status in game.devices.items %}
        <div class="device">
            <form action="{% url 'toggle_device' device %}" method="post">
                {% csrf_token %}

                {% with device_img='EnergyConservationMinigame/'|add:device|lower|add:'_on.png' %}
                {% if status %}
                <img src="{% static device_img %}" alt="{{ device }}">
                {% else %}
                <img src="{% static device_img|cut:'_on.png'|add:'_off.png' %}" alt="{{ device }}">
                {% endif %}
                {% endwith %}

                <br>
                <button type="submit">{{ device }}</button>
            </form>
        </div>
        {% endfor %}
    </div>

    <script>
        let timeLeft = parseFloat("{{ time_left }}");  // Ensure floating point precision

        function updateTimer() {
            if (timeLeft <= 0) {
                window.location.href = "{% url 'game_over' %}";  // Redirect when time runs out
                return;
            }
            document.getElementById("timer").innerText = "Time Left: " + timeLeft.toFixed(3) + " seconds";
            timeLeft -= 0.01;  // Decrease by 10ms per update
            setTimeout(updateTimer, 10);  // Update every 10ms
        }

        updateTimer();
    </script>
</body>
</html>